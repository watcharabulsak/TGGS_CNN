<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TGGS Project</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js">
    </script>
    
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyAUkb0iyPZQrgQNomY-WJj-maCo5bU3RgQ",
        authDomain: "tggs-cnn.firebaseapp.com",
        databaseURL: "https://tggs-cnn-default-rtdb.firebaseio.com",
        projectId: "tggs-cnn",
        storageBucket: "tggs-cnn.appspot.com",
        messagingSenderId: "295976218331",
        appId: "1:295976218331:web:9dc4f9bdc06a4d60f4a6fe"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>
  



</head>
<body>
    <!-- <div class="container">
        <form action ="/uploadfile" method =post enctype="multipart/form-data">
          <div class="form-group">
            <label for="exampleFormControlFile1" style="margin-bottom: 30px; font-size: 30px; color: blue;">House or Condo Classification</label>

            <input type="file" class="form-control-file" id="exampleFormControlFile1" name = "file" style="margin-bottom: 10px;">
            <input class="btn btn-primary" type="submit" value="uploads">
          </div>
        </form>
      </div>     -->

      <div class="container">
 
        <br /><br />
       <!-- แสดงปุ่ม เข้าสู่ระบบ และออกจากระบบ  -->
        <div id="login_panel" class='text-right' >
              
    <!-- ปุ่มเข้าสู่ระบบ  -->          
    <button class="btn btn-primary btn_login "  style="display:none" > <i class="fa fa-key" ></i> เข้าสู่ระบบ </button>
              <span class="user_info" ></span> <!-- แสดง ข้อมูลผู้ใช้ ที่ login อยู่  -->
    <!-- ปุ่มออกจากระบบ  --> 
              <button class="btn btn-danger  btn_sign_out " style="display:none" > <i class="fa fa-sign-out-alt" ></i> ออกจากระบบ </button> 
        </div>
    
    
       
    <!--   สำหรับเลือกไฟล์  -->
         <div id="upload_panel" style="display: none" >
    
                <div class="form-group">
    
                        <label>เลือกไฟล์</label>
                        <!-- input type file สำหรับเลือกไฟล์ที่จะ upload -->
                        <input class="form-control-file" type="file" id="file_upload"  />
                       
                        <!-- แสดง percent สถานะการ upload -->
                         <h4 id="upload_status"></h4>
    
                </div>
             
    
        </div>
    
    
        
       <script>
    var current_user=null;
    
    
    firebase.auth().onAuthStateChanged(function(user) { //กำหนดชุดคำสั่งเมื่อสถานะการ login เปลี่ยน
        if (user) //กรณี login แล้ว
        {
                console.log(user);
                current_user=user;//เก็บข้อมูลของผู้ใช้ปัจจุบัน
        
                $("#login_panel").find(".btn_login").css("display","none");//ซ่อนปุ่ม login
                $("#login_panel").find(".btn_sign_out").css("display","");//แสดงปุ่ม ออกจากระบบ
                $("#upload_panel").css("display","");//แสดงส่วนให้ Upload ไฟล์
                $("#login_panel").find(".user_info").html(user.displayName);//แสดงชื่อผู้ใช้ที่ login
    
        }
        else
        {
           //กรณียังไม่ได้ login
            $("#login_panel").find(".btn_login").css("display","");//แสดงปุ่มให้ login
            $("#login_panel").find(".btn_sign_out").css("display","none");//ซ่อนปุ่มออกจากระบบ
            $("#upload_panel").css("display","none");//ซ่อนส่วนให้ Upload ไฟล์ 
            $("#login_panel").find(".user_info").html("");//กำหนดให้ส่วนแสดงผู้ใช้ที่ login อยู๋ เป็นค่าว่าง
    }
    
    });
    
    
    $("#login_panel").find(".btn_login").on("click",function(){ //กำหนดชุดคำสั่ง เมื่อกด ปุ่ม login
    //แสดงหน้าต่างให้ login โดยใช้ google account
      var GoogleAuthProvider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithRedirect(GoogleAuthProvider);
    
    });
    $("#login_panel").find(".btn_sign_out").on("click",function(){
    //กำหนดชุดคำสั่งเมื่อกดปุ่ม ออกจากระบบ
          
    //ออกจากระบบ โดยใช้ firebase
          firebase.auth().signOut().then(function() {
            current_user=null;//กำหนดตัวแปร object เก็บข้อมูลผู้ใช้เป็นค่า null
          });
    
    });
    
    $("#file_upload").on("change",function(event){ //กำหนดชุดคำสั่งเมื่อเลือกไฟล์
    
    
        var file=event.target.files[0];//เก็บ object file ไว้ในตัวแปร file
    
        if(file==null)//ถ้า object file เป็น null ให้ ออกจาก function
        {
            return;
        }
    
        var file_ref=firebase.storage().ref(file.name);//สร้าง file ใน firebase
        var task=file_ref.put(file);// upload file เข้าไปใน firebase
     
        //กำหนดชุดคำสั่งให้ทำงานเมื่อมีการเปลี่ยนสถานะ
        task.on("state_changed",
    
            function progress(snapshot){//แสดง percent ความก้าวหน้าเมื่อ upload
    
                var percent=( snapshot.bytesTransferred / snapshot.totalBytes)*100;//คิดค่า % ความก้าวหน้า
             
                //แสดง % ความก้าวหน้าที่ <h4 id="upload_status"></h4>                       
                $("#upload_status").html(percent+"%");
            },
            function err(err){ //กำหนดชุดคำสั่งให้ทำงานเมื่อ upload  error
    
            },
            function complete(){ //กำหนดชุดคำสั่ง เมื่อ Upload เสร็จแล้ว
    
                $("#upload_status").html("");//ซ่อน % ความก้าวหน้า เมื่อ Upload เสร็จแล้ว
                $("#file_upload").val("");//ให้ input file เป็นค่าว่าง
                //แสดงรูปภาพที่ เพิ่ง Upload
               // หา URL ของ ไฟล์รูปที่เพิ่ง Upload
                firebase.storage().ref(file.name).getDownloadURL().then(function(url) {
                     //แสดงรูปภาพใน <h4 id="upload_status"></h4>                
                    var img=document.createElement("img");
                    $(img).prop("src",url);
    
                    $("#upload_status").html(img);
    
                });
            },
      
        );
    
    
    
    })
    
    
       </script>
    </div>

    <div class="container">
      <form action ="/predict" method = "post" enctype="multipart/form-data">
        <div class="form-group">
          <label for="exampleFormControlFile1" style="margin-bottom: 30px; font-size: 30px; color: blue;"> Image Prediction </label>
          <span>{{result}}</span>
          <br>
          <label name = "predict"></label>
          <button type="button" class="btn btn-default"  name = "predict">predict</button>

          <span>{{label}}</span>
        </div>
      </form>
    </div>

</body>
</html>

